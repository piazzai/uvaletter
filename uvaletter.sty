\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{uvaletter}

\RequirePackage[lf]{ebgaramond}
\RequirePackage[T1]{fontenc}
\RequirePackage[utf8]{inputenc}
\RequirePackage[a4paper,margin=3cm]{geometry}
\RequirePackage{microtype,fancyhdr,setspace,graphicx,ifthen,soul,lastpage}

\pagestyle{fancy}
\fancyhf{}
\DeclareOption{pageno}{\rfoot{Page~\thepage~of~\pageref{LastPage}}}

\newenvironment{letterhead}{%
 \begin{minipage}{\textwidth}
  \vspace{-2cm}\hspace{-1.31cm}\includegraphics[width=.65\textwidth]{logo}
 \end{minipage}
 \begin{minipage}[b]{.5\textwidth}
  \raggedright\@recipient
 \end{minipage}
 \begin{minipage}[b]{.5\textwidth}
  \raggedleft\small
  {\bfseries\@department} \\
  \ifthenelse{\equal{\@visiting}{}}{}{\medskip\@visiting \\}
  \ifthenelse{\equal{\@postal}{}}{}{\medskip\@postal \\}
  \medskip\@website
 \end{minipage}

 \bigskip\bigskip
 \begin{minipage}{.3\textwidth}
  {\footnotesize Date}
  \newline\@date
 \end{minipage}
 \begin{minipage}{.3\textwidth}
  {\footnotesize Your reference}
  \newline\@yourreference
 \end{minipage}
 \begin{minipage}{.3\textwidth}
  {\footnotesize Our reference}
  \newline\@ourreference
 \end{minipage}

 \begin{minipage}{.3\textwidth}
  {\footnotesize Contact person}
  \newline\@contactperson
 \end{minipage}
 \begin{minipage}{.3\textwidth}
  {\footnotesize Telephone}
  \newline\@phone
 \end{minipage}
 \begin{minipage}{.3\textwidth}
  {\footnotesize Email}
  \newline\@email
 \end{minipage}

 \begin{minipage}{\textwidth}
  {\footnotesize Subject}
  \newline\@subject
 \end{minipage}

 \ifthenelse{\equal{\@enclosed}{}}{\bigskip}{%
  \begin{minipage}{\textwidth}
   {\footnotesize Enclosed}
   \newline\@enclosed
  \end{minipage}
  \bigskip
 }
 \raggedright
}{}

\ProcessOptions
\setlength{\parindent}{0pt}
\setlength{\parskip}{1em plus 0.2em minus 0.2em}
\renewcommand{\headrulewidth}{0pt}
\newcommand\recipient[1]{\renewcommand\@recipient{#1}}
\newcommand\@recipient{}
\newcommand\department[1]{\renewcommand\@department{#1}}
\newcommand\@department{}
\newcommand\visiting[1]{\renewcommand\@visiting{#1}}
\newcommand\@visiting{}
\newcommand\postal[1]{\renewcommand\@postal{#1}}
\newcommand\@postal{}
\newcommand\website[1]{\renewcommand\@website{#1}}
\newcommand\@website{}
\newcommand\yourreference[1]{\renewcommand\@yourreference{#1}}
\newcommand\@yourreference{}
\newcommand\ourreference[1]{\renewcommand\@ourreference{#1}}
\newcommand\@ourreference{}
\newcommand\contactperson[1]{\renewcommand\@contactperson{#1}}
\newcommand\@contactperson{}
\newcommand\phone[1]{\renewcommand\@phone{#1}}
\newcommand\@phone{}
\newcommand\email[1]{\renewcommand\@email{#1}}
\newcommand\@email{}
\newcommand\subject[1]{\renewcommand\@subject{#1}}
\newcommand\@subject{}
\newcommand\enclosed[1]{\renewcommand\@enclosed{#1}}
\newcommand\@enclosed{}
